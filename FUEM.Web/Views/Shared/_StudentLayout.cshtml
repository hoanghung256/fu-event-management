@using System.Security.Claims
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
<!DOCTYPE html>
<html class="no-js" lang="en" style="--clr-theme-1: #ff6f00 !important;">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>FUEM-FPTU Event Management System - Student</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-style-mode" content="1">
    <link rel="shortcut icon" type="image/x-icon" href="~/img/logo/logo-fpt-small.svg" />

    <link rel="stylesheet" href="@Url.Content("~/theme/css/bootstrap.min.css")" />
    <link rel="stylesheet" href="@Url.Content("~/theme/css/meanmenu.min.css")" />
    <link rel="stylesheet" href="@Url.Content("~/theme/css/animate.css")" />
    <link rel="stylesheet" href="@Url.Content("~/theme/css/metisMenu.min.css")" />
    <link rel="stylesheet" href="@Url.Content("~/theme/css/fontawesome-pro.css")" />
    <link rel="stylesheet" href="@Url.Content("~/theme/css/main.css")" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/main.min.css' rel='stylesheet' /> <!-- FullCalendar CSS -->
    <style>
        body {
            display: flex; /* Use flexbox for the entire layout */
            min-height: 100vh; /* Ensure body takes full viewport height */
            margin: 0;
            flex-direction: row; /* Sidebar and main content side-by-side */
        }

        .expovent__sidebar .logo-details {
            text-align: center;
            margin-bottom: 20px;
            display: flex; /* Ensure it's a flex container */
            align-items: center; /* IMPORTANT: Vertically center child items (logo) */
            justify-content: center; /* Horizontally center child items */
            min-height: 50px; /* Ensure enough space */
            /* Add small adjustments to fix misalignment */
            padding-top: 5px; /* Adjust to push up slightly if needed */
            padding-bottom: 5px; /* Adjust to push up slightly if needed */
        }

            /* Ensure small logo and text logo are vertically centered in .logo-details */
            .expovent__sidebar .logo-details .logo__white,
            .expovent__sidebar .logo-details .log__smnall {
                vertical-align: middle; /* Ensure vertical centering if not flex */
                /* If still misaligned, consider margin-top/bottom or transform */
            }

            /* Adjust margin for logo__white to prevent misalignment with text logo */
            .expovent__sidebar .logo-details .logo__white {
                max-width: 60px; /* Size for small logo (fpt icon) */
                height: auto;
                transition: opacity 0.3s ease, margin-right 0.3s ease;
                /* Add or adjust margin-right if a small gap is needed between the two logos */
                margin-right: 5px; /* Small gap between FPT icon and FPT University text */
            }

        .expovent__sidebar.collapsed .logo-details .logo__white {
            margin-right: 0; /* Remove margin when collapsed so icon is centered */
        }

        .expovent__sidebar.collapsed .logo-details .logo__white {
            margin-right: 0; /* Remove margin when collapsed so icon is centered */
        }


        .expovent__sidebar .logo-details .log__smnall { /* "FPT UNIVERSITY" text logo */
            max-width: 140px; /* Original width */
            margin-left: 1rem;
            transition: opacity 0.3s ease, width 0.3s ease, margin-left 0.3s ease;
        }

        .expovent__sidebar.collapsed .logo-details .log__smnall {
            opacity: 0; /* Hide text logo */
            width: 0; /* Collapse width */
            margin-left: 0; /* Remove margin */
        }

        .expovent__sidebar .sidebar__inner {
            flex-grow: 1; /* Allow menu to take remaining space */
            display: flex;
            flex-direction: column;
        }

        .expovent__sidebar ul {
            list-style: none;
            padding-left: 0;
            margin: 0;
            flex-grow: 1; /* Allow menu to push copyright to the bottom */
        }

            .expovent__sidebar ul li {
                margin-bottom: 12px;
            }

                .expovent__sidebar ul li a {
                    display: flex;
                    align-items: center;
                    padding: 10px 14px;
                    color: white;
                    text-decoration: none;
                    border-radius: 8px;
                    transition: background-color 0.3s ease, padding 0.3s ease;
                    white-space: nowrap; /* Prevent text from wrapping */
                    overflow: hidden; /* Hide text when collapsed */
                    justify-content: flex-start; /* Default align left */
                }

        /* Center icon when sidebar is collapsed */
        .expovent__sidebar.collapsed ul li a {
            justify-content: center; /* Center icon */
            padding: 10px 0; /* Adjust horizontal padding when collapsed */
        }

        .expovent__sidebar ul li a i {
            margin-right: 10px;
            min-width: 20px;
            text-align: center;
        }

        .expovent__sidebar.collapsed ul li a i {
            margin-right: 0; /* Remove margin to fully center icon */
        }

        .expovent__sidebar ul li a:hover {
            background-color: #ff6f00;
            padding-left: 18px; /* Padding effect on hover */
        }

        .expovent__sidebar.collapsed ul li a:hover {
            padding-left: 0; /* No extra padding when collapsed and hovered */
        }


        .expovent__sidebar.collapsed .nav-text {
            opacity: 0;
            width: 0;
            display: none; /* Fully hide text */
        }

        /* --- Footer (Copyright) Alignment Fix --- */
        .sidebar__copyright {
            text-align: center;
            padding-top: 20px; /* Space above copyright */
            padding-bottom: 10px;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            width: 100%; /* Ensure it takes full width of sidebar */
            background-color: #000; /* Ensure background matches sidebar */
            margin-top: auto; /* Push copyright to the bottom of the flex container (sidebar__inner) */
            transition: opacity 0.3s ease, height 0.3s ease, padding 0.3s ease; /* Transition effect */
            box-sizing: border-box; /* Ensure padding doesn't overflow width */
        }

        .expovent__sidebar.collapsed .sidebar__copyright {
            opacity: 0; /* Hide copyright when collapsed */
            height: 0; /* Collapse height */
            overflow: hidden; /* Prevent content overflow when height = 0 */
            padding-top: 0; /* Remove padding when hidden */
            padding-bottom: 0; /* Remove padding when hidden */
        }


        /* --- Main Content Area --- */
        .page__body-wrapper {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            background-color: #f5f5f5;
            overflow-x: hidden;
        }

        /* --- Header Styling --- */
        .app__header__area {
            background: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #ddd;
            align-items: center;
            flex-shrink: 0;
        }

        .app__header-left {
            display: flex;
            align-items: center;
        }

        .app__header-toggle {
            background-color: #fff;
            padding: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 40px;
            width: 40px;
            transition: background-color 0.2s;
        }

            .app__header-toggle:hover {
                background-color: #f5f5f5;
            }

            .app__header-toggle i {
                font-size: 20px;
                color: #ff6f00;
                transition: transform 0.2s ease;
            }

            .app__header-toggle:hover i {
                transform: scale(1.1);
            }


        .bar-icon-2 span {
            display: block;
            width: 25px;
            height: 3px;
            margin: 5px 0;
            background-color: #333;
            transition: 0.3s;
        }

        /* --- Right alignment for profile --- */
        .app__header-right {
            display: flex; /* Ensure it's a flex container */
            align-items: center; /* Vertically center items inside */
            /* margin-left: auto; */ /* Usually not needed if justify-content: space-between works well */
        }

        .user__portfolio {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background-color 0.2s;
            position: relative; /* Important for dropdown positioning */
        }

            .user__portfolio:hover {
                background-color: #f1f1f1;
            }


        .user__portfolio-thumb img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 10px;
        }

        .user__content span {
            font-weight: 500;
            color: #333;
        }

        /* User dropdown menu styling */
        .user__dropdown {
            position: absolute;
            top: 100%;
            right: 0; /* Ensure dropdown aligns to the right of user__portfolio */
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0px 8px 16px rgba(0,0,0,0.2);
            z-index: 1000;
            min-width: 160px;
            display: none;
            padding: 10px 0;
            list-style: none;
        }

            .user__dropdown ul {
                padding: 0;
                margin: 0;
            }

            .user__dropdown li a {
                color: #333;
                padding: 10px 15px;
                text-decoration: none;
                display: flex;
                align-items: center;
                white-space: nowrap;
            }

                .user__dropdown li a:hover {
                    background-color: #f1f1f1;
                    color: #ff6f00;
                }

                .user__dropdown li a svg {
                    margin-right: 8px;
                }

        /* --- Padding for main content --- */
        .main-content {
            padding: 2rem;
            flex-grow: 1; /* Allow content to take remaining height */
            overflow-y: auto; /* Add scrollbar if content overflows */
        }
    </style>
</head>

<body class="body-area">
    <div id="preloader">
        <div class="sk-three-bounce">
            <div class="sk-child sk-bounce1"></div>
            <div class="sk-child sk-bounce2"></div>
            <div class="sk-child sk-bounce3"></div>
        </div>
    </div>

    <div class="expovent__sidebar">
        <div class="logo-details">
            <span>
                <a href="@Url.Action("Index", "Home")">
                    <img class="logo__white" src="~/img/logo/logo-fpt-small.svg" alt="FPT Logo">
                </a>
            </span>
            <span>
                <a href="@Url.Action("Index", "Home")">
                    <img class="log__smnall" src="~/img/logo/logoFpt.svg.png" alt="FPT University Logo">
                </a>
            </span>
        </div>
        <div class="sidebar__inner simple-bar">
            <div class="dlabnav">
                <ul class="metismenu" id="menu">
                    <li>
                        <a class="asidebar" href="@Url.Action("Index", "Home")" aria-expanded="false" style="text-decoration: none;">
                            <i class="fa-solid fa-house"></i>
                            <span class="nav-text ">Home</span>
                        </a>
                    </li>
                    <li>
                        <a class="asidebar" href="@Url.Action("Index", "AttendedEvents")" aria-expanded="false" style="text-decoration: none;">
                            <i class="fa-solid fa-calendar-check"></i>
                            <span class="nav-text">Attended Events</span>
                        </a>
                    </li>
                    <li>
                        <a class="asidebar" href="@Url.Action("StudentCalendar", "Student")" aria-expanded="false" style="text-decoration: none;">
                            <i class="fa-solid fa-file-signature"></i>
                            <span class="nav-text">Registered Events</span>
                        </a>
                    </li>
                    <li>
                        <a class="asidebar" href="@Url.Action("Profile", "Student")" aria-expanded="false" style="text-decoration: none;">
                            <i class="fa-solid fa-user"></i>
                            <span class="nav-text">Profile</span>
                        </a>
                    </li>
                    <li>
                        <a class="asidebar" href="@Url.Action("SignOut", "Authentication")" aria-expanded="false" style="text-decoration: none;">
                            <i class="fa-solid fa-right-from-bracket"></i>
                            <span class="nav-text">Log out</span>
                        </a>
                    </li>
                </ul>
                <div class="sidebar__copyright">
                    <p>Copyright FUEM 2025</p>
                </div>
            </div>
        </div>
    </div>
    <div class="page__body-wrapper">
        <div class="app__header__area">
            <div class="app__header-left">
                <a id="sidebar__active" class="app__header-toggle" href="javascript:void(0)">
                    <i class="fa-solid fa-bars"></i>
                </a>
            </div>

            <div class="app__header-right">

                <div class="nav-item p-relative">
                    <div class="dropdown">
                        <!-- Trigger -->
                        <a id="userportfolio"
                           href="#"
                           class="user__portfolio dropdown-toggle"
                           role="button"
                           data-bs-toggle="dropdown"
                           aria-expanded="false"
                           style="text-decoration: none;">
                            <div class="user__portfolio-thumb">
                                @{
                                    var avatarPath = HttpContextAccessor.HttpContext.Session.GetString("avatarPath") ?? "~/img/user/default-avatar.jpg";
                                }
                                <img class="rounded-circle" src="@Url.Content(avatarPath)" alt="Avatar" />
                            </div>
                            <div class="user__content">
                                <span>@User.FindFirst(ClaimTypes.GivenName)?.Value</span>
                            </div>
                        </a>

                        <!-- Dropdown Menu -->
                        <ul class="dropdown-menu">
                            <li>
                                <a class="dropdown-item" href="@Url.Action("Profile", "Student")" style="text-decoration: none;">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g clip-path="url(#clip0_643_344)">
                                            <path d="M13.6569 10.3431C12.7855 9.47181 11.7484 8.82678 10.6168 8.43631C11.8288 7.60159 12.625 6.20463 12.625 4.625C12.625 2.07478 10.5502 0 8 0C5.44978 0 3.375 2.07478 3.375 4.625C3.375 6.20463 4.17122 7.60159 5.38319 8.43631C4.25162 8.82678 3.2145 9.47181 2.34316 10.3431C0.832156 11.8542 0 13.8631 0 16H1.25C1.25 12.278 4.27803 9.25 8 9.25C11.722 9.25 14.75 12.278 14.75 16H16C16 13.8631 15.1678 11.8542 13.6569 10.3431ZM8 8C6.13903 8 4.625 6.486 4.625 4.625C4.625 2.764 6.13903 1.25 8 1.25C9.86097 1.25 11.375 2.764 11.375 4.625C11.375 6.486 9.86097 8 8 8Z" fill="#7A7A7A" />
                                        </g>
                                        <defs>
                                            <clipPath id="clip0_643_344">
                                                <rect width="16" height="16" fill="white" />
                                            </clipPath>
                                        </defs>
                                    </svg>
                                    Profile
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="@Url.Action("SignOut", "Authentication")" style="text-decoration: none;">
                                    <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g clip-path="url(#clip0_643_343)">
                                            <path d="M17.4368 8.43771H10.312C10.0015 8.43771 9.74951 8.18572 9.74951 7.87523C9.74951 7.56474 10.0015 7.31274 10.312 7.31274H17.4368C17.7473 7.31274 17.9993 7.56474 17.9993 7.87523C17.9993 8.18572 17.7473 8.43771 17.4368 8.43771Z" fill="#7A7A7A" />
                                            <path d="M14.6244 11.2502C14.4803 11.2502 14.3364 11.1954 14.2268 11.0852C14.0071 10.8654 14.0071 10.5091 14.2268 10.2894L16.6418 7.87457L14.2268 5.45958C14.0071 5.23986 14.0071 4.88364 14.2268 4.66392C14.4467 4.44406 14.8029 4.44406 15.0226 4.66392L17.835 7.47633C18.0547 7.69605 18.0547 8.05227 17.835 8.27199L15.0226 11.0844C14.9123 11.1954 14.7684 11.2502 14.6244 11.2502Z" fill="#7A7A7A" />
                                            <path d="M5.99986 18.0002C5.83932 18.0002 5.68703 17.9776 5.53488 17.9304L1.02142 16.4267C0.407305 16.2122 0 15.64 0 15.0003V1.50073C0 0.673487 0.672754 0.000732422 1.5 0.000732422C1.66039 0.000732422 1.81269 0.0232537 1.96498 0.0704934L6.4783 1.5742C7.09255 1.7887 7.49972 2.36093 7.49972 3.00059V16.5002C7.49972 17.3274 6.8271 18.0002 5.99986 18.0002ZM1.5 1.1257C1.29374 1.1257 1.12496 1.29447 1.12496 1.50073V15.0003C1.12496 15.16 1.23222 15.3085 1.38520 15.3617L5.8775 16.8587C5.90977 16.8692 5.95179 16.8752 5.99986 16.8752C6.20612 16.8752 6.37475 16.7064 6.37475 16.5002V3.00059C6.37475 2.84088 6.2675 2.69244 6.11452 2.63915L1.62222 1.14218C1.58995 1.13174 1.54793 1.1257 1.5 1.1257Z" fill="#7A7A7A" />
                                            <path d="M11.4371 6.00035C11.1266 6.00035 10.8746 5.74836 10.8746 5.43786V2.06297C10.8746 1.54622 10.454 1.12545 9.93722 1.12545H1.49998C1.18949 1.12545 0.9375 0.873462 0.9375 0.562971C0.9375 0.252479 1.18949 0.000488281 1.49998 0.000488281H9.93722C11.075 0.000488281 11.9996 0.925234 11.9996 2.06297V5.43786C11.9996 5.74836 11.7476 6.00035 11.4371 6.00035Z" fill="#7A7A7A" />
                                            <path d="M9.93699 15.7501H6.93699C6.6265 15.7501 6.37451 15.4981 6.37451 15.1876C6.37451 14.8771 6.6265 14.6251 6.93699 14.6251H9.93699C10.4537 14.6251 10.8744 14.2044 10.8744 13.6876V10.3127C10.8744 10.0022 11.1264 9.75024 11.4369 9.75024C11.7473 9.75024 11.9993 10.0022 11.9993 10.3127V13.6876C11.9993 14.8254 11.0747 15.7501 9.93699 15.7501Z" fill="#7A7A7A" />
                                        </g>
                                        <defs>
                                            <clipPath id="clip0_643_343">
                                                <rect width="18" height="18" fill="white" />
                                            </clipPath>
                                        </defs>
                                    </svg>
                                    Sign out
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="main-content mt-5 pt-5">
            @RenderBody()
        </div>
    </div>

    <script src="~/theme/js/jquery-3.6.0.min.js"></script>
    <script src="~/theme/js/bootstrap.bundle.min.js"></script>
    <script src="~/theme/js/metisMenu.min.js"></script>
    <script src="~/theme/js/meanmenu.min.js"></script>
    <script src="~/theme/js/swiper-bundle.min.js"></script>
    <script src="~/theme/js/slick.min.js"></script>
    <script src="~/theme/js/backtotop.js"></script>
    <script src="~/theme/js/magnific-popup.min.js"></script>
    <script src="~/theme/js/wow.min.js"></script>
    <script src="~/theme/js/main.js"></script>
    @await Html.PartialAsync("_ToastSetUp")
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script> <!-- FullCalendar JS -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/locales/vi.global.min.js'></script> <!-- Ngôn ngữ tiếng Việt -->
    @await RenderSectionAsync("Scripts", required: false)

    <script>
        $(document).ready(function () {
            $('#menu').metisMenu();

            // Toggle sidebar
            $('#sidebar__active').on('click', function () {
                $('.expovent__sidebar').toggleClass('collapsed');
            });

            // Handle user dropdown
            $('#userportfolio').on('click', function (e) {
                e.preventDefault(); // Prevent default link behavior
                e.stopPropagation(); // Prevent event propagation to avoid immediate closing
                $('.user__dropdown').toggle(); // Toggle dropdown visibility
            });

            // Close dropdown when clicking outside
            $(document).on('click', function (e) {
                if (!$(e.target).closest('.nav-item.p-relative').length) {
                    $('.user__dropdown').hide();
                }
            });
        });
    </script>
</body>
</html>