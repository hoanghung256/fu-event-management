@using System.Security.Claims
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
<!DOCTYPE html>
<html class="no-js" lang="en" style="--clr-theme-1: #ff6f00 !important;">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>FUEM-FPTU Event Management System - Student</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-style-mode" content="1">
    <link rel="shortcut icon" type="image/x-icon" href="@Url.Content("~/img/logo/logo-fpt-small.svg")" />

    <link rel="stylesheet" href="@Url.Content("~/theme/css/bootstrap.min.css")">
    <link rel="stylesheet" href="@Url.Content("~/theme/css/meanmenu.min.css")">
    <link rel="stylesheet" href="@Url.Content("~/theme/css/animate.css")">
    <link rel="stylesheet" href="@Url.Content("~/theme/css/metisMenu.min.css")">
    <link rel="stylesheet" href="@Url.Content("~/theme/css/swiper-bundle.min.css")">
    <link rel="stylesheet" href="@Url.Content("~/theme/css/slick.css")">
    <link rel="stylesheet" href="@Url.Content("~/theme/css/backtotop.css")">
    <link rel="stylesheet" href="@Url.Content("~/theme/css/magnific-popup.css")">
    <link rel="stylesheet" href="@Url.Content("~/theme/css/flaticon_expovent.css")">
    <link rel="stylesheet" href="@Url.Content("~/theme/css/fontawesome-pro.css")">
    <link rel="stylesheet" href="@Url.Content("~/theme/css/spacing.css")">
    <link rel="stylesheet" href="@Url.Content("~/theme/css/main.css")">

    <style>
        body {
            display: flex; /* Dùng flexbox cho toàn bộ layout */
            min-height: 100vh; /* Đảm bảo body chiếm toàn bộ chiều cao viewport */
            margin: 0;
            flex-direction: row; /* Sidebar và nội dung chính nằm cạnh nhau */
            overflow: hidden; /* Ngăn thanh cuộn ngang không mong muốn */
        }

        .expovent__sidebar .logo-details {
            text-align: center;
            margin-bottom: 20px;
            display: flex; /* Đảm bảo là flex container */
            align-items: center; /* QUAN TRỌNG: Căn giữa theo chiều dọc các item con (logo) */
            justify-content: center; /* Căn giữa theo chiều ngang các item con */
            min-height: 50px; /* Đảm bảo có đủ không gian */
            /* Thêm một số điều chỉnh nhỏ để khắc phục độ lệch */
            padding-top: 5px; /* Điều chỉnh để đẩy lên một chút nếu cần */
            padding-bottom: 5px; /* Điều chỉnh để đẩy lên một chút nếu cần */
        }

        /* Đảm bảo logo nhỏ và logo chữ được căn giữa theo chiều dọc trong .logo-details */
        .expovent__sidebar .logo-details .logo__white,
        .expovent__sidebar .logo-details .log__smnall {
            vertical-align: middle; /* Đảm bảo căn giữa theo chiều dọc nếu không phải flex */
            /* Nếu vẫn lệch, có thể dùng margin-top/bottom hoặc transform */
        }

        /* Điều chỉnh margin cho logo__white để nó không bị lệch so với logo chữ */
        .expovent__sidebar .logo-details .logo__white {
            max-width: 60px; /* Kích thước cho logo nhỏ (fpt icon) */
            height: auto;
            transition: opacity 0.3s ease, margin-right 0.3s ease;
            /* Thêm hoặc điều chỉnh margin-right nếu cần một khoảng cách nhỏ giữa 2 logo */
            margin-right: 5px; /* Khoảng cách nhỏ giữa icon FPT và chữ FPT University */
        }

        .expovent__sidebar.collapsed .logo-details .logo__white {
            margin-right: 0; /* Loại bỏ margin khi thu gọn để icon nằm giữa */
        }

            .expovent__sidebar.collapsed .logo-details .logo__white {
                margin-right: 0; /* Loại bỏ margin khi thu gọn để icon nằm giữa */
            }


            .expovent__sidebar .logo-details .log__smnall { /* Logo chữ "FPT UNIVERSITY" */
                max-width: 140px; /* Chiều rộng gốc */
                margin-left: 1rem;
                transition: opacity 0.3s ease, width 0.3s ease, margin-left 0.3s ease;
            }

            .expovent__sidebar.collapsed .logo-details .log__smnall {
                opacity: 0; /* Ẩn logo chữ */
                width: 0; /* Co lại chiều rộng */
                margin-left: 0; /* Bỏ margin */
            }

            .expovent__sidebar .sidebar__inner {
                flex-grow: 1; /* Cho phép menu chiếm hết không gian còn lại */
                display: flex;
                flex-direction: column;
            }

            .expovent__sidebar ul {
                list-style: none;
                padding-left: 0;
                margin: 0;
                flex-grow: 1; /* Cho phép menu đẩy copyright xuống dưới */
            }

                .expovent__sidebar ul li {
                    margin-bottom: 12px;
                }

                    .expovent__sidebar ul li a {
                        display: flex;
                        align-items: center;
                        padding: 10px 14px;
                        color: white;
                        text-decoration: none;
                        border-radius: 8px;
                        transition: background-color 0.3s ease, padding 0.3s ease;
                        white-space: nowrap; /* Ngăn không cho văn bản xuống dòng */
                        overflow: hidden; /* Ẩn văn bản khi thu gọn */
                        justify-content: flex-start; /* Mặc định căn trái */
                    }

            /* Căn giữa icon khi sidebar thu gọn */
            .expovent__sidebar.collapsed ul li a {
                justify-content: center; /* Căn giữa icon */
                padding: 10px 0; /* Điều chỉnh padding ngang khi thu gọn */
            }

            .expovent__sidebar ul li a i {
                margin-right: 10px;
                min-width: 20px;
                text-align: center;
            }

            .expovent__sidebar.collapsed ul li a i {
                margin-right: 0; /* Bỏ margin để icon nằm giữa hoàn toàn */
            }

            .expovent__sidebar ul li a:hover {
                background-color: #ff6f00;
                padding-left: 18px; /* Hiệu ứng padding khi hover */
            }

            .expovent__sidebar.collapsed ul li a:hover {
                padding-left: 0; /* Không có padding thêm khi thu gọn và hover */
            }


            .expovent__sidebar.collapsed .nav-text {
                opacity: 0;
                width: 0;
                display: none; /* Ẩn hoàn toàn văn bản */
            }

        /* --- Sửa lỗi căn chỉnh Footer (Copyright) --- */
        .sidebar__copyright {
            text-align: center;
            padding-top: 20px; /* Khoảng cách phía trên copyright */
            padding-bottom: 10px;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            width: 100%; /* Đảm bảo chiếm hết chiều rộng của sidebar */
            background-color: #000; /* Đảm bảo nền khớp với sidebar */
            margin-top: auto; /* Đẩy copyright xuống đáy của flex container (sidebar__inner) */
            transition: opacity 0.3s ease, height 0.3s ease, padding 0.3s ease; /* Hiệu ứng chuyển động */
            box-sizing: border-box; /* Đảm bảo padding không làm tràn width */
        }

        .expovent__sidebar.collapsed .sidebar__copyright {
            opacity: 0; /* Ẩn copyright khi thu gọn */
            height: 0; /* Thu gọn chiều cao */
            overflow: hidden; /* Ngăn nội dung bị tràn khi height = 0 */
            padding-top: 0; /* Bỏ padding khi ẩn */
            padding-bottom: 0; /* Bỏ padding khi ẩn */
        }


        /* --- Khu vực nội dung chính --- */
       /* --- Khu vực nội dung chính --- */
        .page__body-wrapper {
            flex-grow: 1; /* Cho phép nội dung chính chiếm hết không gian còn lại */
            display: flex;
            flex-direction: column;
            background-color: #f5f5f5; /* Nền xám nhạt cho nội dung */
            /* Thêm overflow-x: hidden để ngăn header bị tràn khi kéo giãn sidebar */
            overflow-x: hidden;
        }

        /* --- Định kiểu Header --- */
        .app__header__area {
            background: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between; /* Rất quan trọng: đẩy các phần tử con ra hai phía */
            border-bottom: 1px solid #ddd;
            align-items: center; /* Căn giữa các mục theo chiều dọc */
            flex-shrink: 0; /* Ngăn không cho header co lại */
            /* BỎ width: 100%; ở đây vì nó sẽ được quản lý bởi flex-grow của page__body-wrapper */
            /* width: 100%; */
        }

        .app__header-left {
            display: flex;
            align-items: center;
        }

        .app__header-toggle {
            cursor: pointer;
            padding: 5px;
        }

        .bar-icon-2 span {
            display: block;
            width: 25px;
            height: 3px;
            margin: 5px 0;
            background-color: #333;
            transition: 0.3s;
        }

        /* --- Căn phải cho profile --- */
        .app__header-right {
            display: flex; /* Đảm bảo nó là một flex container */
            align-items: center; /* Căn giữa các mục bên trong theo chiều dọc */
            /* margin-left: auto; */ /* Thường không cần nếu justify-content: space-between hoạt động tốt */
        }

        .user__portfolio {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background-color 0.2s;
            position: relative; /* Quan trọng cho việc định vị dropdown */
        }

            .user__portfolio:hover {
                background-color: #f1f1f1;
            }


        .user__portfolio-thumb img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 10px;
        }

        .user__content span {
            font-weight: 500;
            color: #333;
        }

        /* Định kiểu dropdown menu người dùng */
        .user__dropdown {
            position: absolute;
            top: 100%;
            right: 0; /* Đảm bảo dropdown căn phải theo user__portfolio */
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0px 8px 16px rgba(0,0,0,0.2);
            z-index: 1000;
            min-width: 160px;
            display: none;
            padding: 10px 0;
            list-style: none;
        }

            .user__dropdown ul {
                padding: 0;
                margin: 0;
            }

            .user__dropdown li a {
                color: #333;
                padding: 10px 15px;
                text-decoration: none;
                display: flex;
                align-items: center;
                white-space: nowrap;
            }

                .user__dropdown li a:hover {
                    background-color: #f1f1f1;
                    color: #ff6f00;
                }

                .user__dropdown li a svg {
                    margin-right: 8px;
                }

        /* --- Padding cho nội dung chính --- */
        .main-content {
            padding: 2rem;
            flex-grow: 1; /* Cho phép nội dung chiếm hết chiều cao còn lại */
            overflow-y: auto; /* Thêm thanh cuộn nếu nội dung tràn ra */
        }
    </style>
</head>

<body class="body-area">
    <div id="preloader">
        <div class="sk-three-bounce">
            <div class="sk-child sk-bounce1"></div>
            <div class="sk-child sk-bounce2"></div>
            <div class="sk-child sk-bounce3"></div>
        </div>
    </div>

    <div class="expovent__sidebar">
        <div class="logo-details">
            <span>
                <a href="@Url.Action("Index", "Home")">
                    <img class="logo__white" src="@Url.Content("~/img/logo/logo-fpt-small.svg")" alt="FPT Logo">
                </a>
            </span>
            <span>
                <a href="@Url.Action("Index", "Home")">
                    <img class="log__smnall" src="@Url.Content("~/img/logo/logoFpt.svg.png")" alt="FPT University Logo">
                </a>
            </span>
        </div>
        <div class="sidebar__inner simple-bar">
            <div class="dlabnav">
                <ul class="metismenu" id="menu">
                    <li>
                        <a class="asidebar" href="@Url.Action("Index", "Home")" aria-expanded="false" style="text-decoration: none;">
                            <i class="fa-solid fa-house"></i>
                            <span class="nav-text ">Home</span>
                        </a>
                    </li>
                    <li>
                        <a class="asidebar" href="@Url.Action("AttendedEvents", "Student")" aria-expanded="false" style="text-decoration: none;">
                            <i class="fa-solid fa-calendar-check"></i>
                            <span class="nav-text">Attended Events</span>
                        </a>
                    </li>
                    <li>
                        <a class="asidebar" href="@Url.Action("RegisteredEvent", "Student")" aria-expanded="false" style="text-decoration: none;">
                            <i class="fa-solid fa-clipboard-list-check"></i>
                            <span class="nav-text">Registered Events</span>
                        </a>
                    </li>
                    <li>
                        <a class="asidebar" href="@Url.Action("Profile", "Student")" aria-expanded="false" style="text-decoration: none;">
                            <i class="fa-solid fa-user"></i>
                            <span class="nav-text">Profile</span>
                        </a>
                    </li>
                    <li>
                        <a class="asidebar" href="@Url.Action("SignOut", "Authentication")" aria-expanded="false" style="text-decoration: none;">
                            <i class="fa-solid fa-right-from-bracket"></i>
                            <span class="nav-text">Log out</span>
                        </a>
                    </li>
                </ul>
                <div class="sidebar__copyright">
                    <p>Copyright FUEM 2024</p>
                </div>
            </div>
        </div>
    </div>
    <div class="page__body-wrapper">
        <div class="app__header__area">
            <div class="app__header-left">
                <a id="sidebar__active" class="app__header-toggle" href="javascript:void(0)">
                    <div class="bar-icon-2">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </a>
            </div>
            <div class="app__header-right">
              
                <div class="nav-item p-relative">
                    <a id="userportfolio" href="#">
                        <div class="user__portfolio">
                            <div class="user__portfolio-thumb">
                                @{
                                    var avatarPath = HttpContextAccessor.HttpContext.Session.GetString("avatarPath") ?? "~/img/user/default-avatar.jpg";
                                }
                                <img class="rounded-circle" src="@Url.Content(avatarPath)" alt="Avatar" />
                            </div>
                            <div class="user__content">
                                <span>@User.FindFirst(ClaimTypes.Email)?.Value</span>
                            </div>
                        </div>
                    </a>
                    <div class="user__dropdown">
                        <ul class="mb-0">
                            <li>
                                <a href="@Url.Action("Profile", "Student")" style="text-decoration: none;">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g clip-path="url(#clip0_643_344)">
                                            <path d="M13.6569 10.3431C12.7855 9.47181 11.7484 8.82678 10.6168 8.43631C11.8288 7.60159 12.625 6.20463 12.625 4.625C12.625 2.07478 10.5502 0 8 0C5.44978 0 3.375 2.07478 3.375 4.625C3.375 6.20463 4.17122 7.60159 5.38319 8.43631C4.25162 8.82678 3.2145 9.47181 2.34316 10.3431C0.832156 11.8542 0 13.8631 0 16H1.25C1.25 12.278 4.27803 9.25 8 9.25C11.722 9.25 14.75 12.278 14.75 16H16C16 13.8631 15.1678 11.8542 13.6569 10.3431ZM8 8C6.13903 8 4.625 6.486 4.625 4.625C4.625 2.764 6.13903 1.25 8 1.25C9.86097 1.25 11.375 2.764 11.375 4.625C11.375 6.486 9.86097 8 8 8Z" fill="#7A7A7A" />
                                        </g>
                                        <defs>
                                            <clipPath id="clip0_643_344">
                                                <rect width="16" height="16" fill="white" />
                                            </clipPath>
                                        </defs>
                                    </svg>
                                    Profile
                                </a>
                            </li>
                            <li>
                                <a href="@Url.Action("SignOut", "Authentication")" style="text-decoration: none;">
                                    <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g clip-path="url(#clip0_643_343)">
                                            <path d="M17.4368 8.43771H10.312C10.0015 8.43771 9.74951 8.18572 9.74951 7.87523C9.74951 7.56474 10.0015 7.31274 10.312 7.31274H17.4368C17.7473 7.31274 17.9993 7.56474 17.9993 7.87523C17.9993 8.18572 17.7473 8.43771 17.4368 8.43771Z" fill="#7A7A7A" />
                                            <path d="M14.6244 11.2502C14.4803 11.2502 14.3364 11.1954 14.2268 11.0852C14.0071 10.8654 14.0071 10.5091 14.2268 10.2894L16.6418 7.87457L14.2268 5.45958C14.0071 5.23986 14.0071 4.88364 14.2268 4.66392C14.4467 4.44406 14.8029 4.44406 15.0226 4.66392L17.835 7.47633C18.0547 7.69605 18.0547 8.05227 17.835 8.27199L15.0226 11.0844C14.9123 11.1954 14.7684 11.2502 14.6244 11.2502Z" fill="#7A7A7A" />
                                            <path d="M5.99986 18.0002C5.83932 18.0002 5.68703 17.9776 5.53488 17.9304L1.02142 16.4267C0.407305 16.2122 0 15.64 0 15.0003V1.50073C0 0.673487 0.672754 0.000732422 1.5 0.000732422C1.66039 0.000732422 1.81269 0.0232537 1.96498 0.0704934L6.4783 1.5742C7.09255 1.7887 7.49972 2.36093 7.49972 3.00059V16.5002C7.49972 17.3274 6.8271 18.0002 5.99986 18.0002ZM1.5 1.1257C1.29374 1.1257 1.12496 1.29447 1.12496 1.50073V15.0003C1.12496 15.16 1.23222 15.3085 1.38520 15.3617L5.8775 16.8587C5.90977 16.8692 5.95179 16.8752 5.99986 16.8752C6.20612 16.8752 6.37475 16.7064 6.37475 16.5002V3.00059C6.37475 2.84088 6.2675 2.69244 6.11452 2.63915L1.62222 1.14218C1.58995 1.13174 1.54793 1.1257 1.5 1.1257Z" fill="#7A7A7A" />
                                            <path d="M11.4371 6.00035C11.1266 6.00035 10.8746 5.74836 10.8746 5.43786V2.06297C10.8746 1.54622 10.454 1.12545 9.93722 1.12545H1.49998C1.18949 1.12545 0.9375 0.873462 0.9375 0.562971C0.9375 0.252479 1.18949 0.000488281 1.49998 0.000488281H9.93722C11.075 0.000488281 11.9996 0.925234 11.9996 2.06297V5.43786C11.9996 5.74836 11.7476 6.00035 11.4371 6.00035Z" fill="#7A7A7A" />
                                            <path d="M9.93699 15.7501H6.93699C6.6265 15.7501 6.37451 15.4981 6.37451 15.1876C6.37451 14.8771 6.6265 14.6251 6.93699 14.6251H9.93699C10.4537 14.6251 10.8744 14.2044 10.8744 13.6876V10.3127C10.8744 10.0022 11.1264 9.75024 11.4369 9.75024C11.7473 9.75024 11.9993 10.0022 11.9993 10.3127V13.6876C11.9993 14.8254 11.0747 15.7501 9.93699 15.7501Z" fill="#7A7A7A" />
                                        </g>
                                        <defs>
                                            <clipPath id="clip0_643_343">
                                                <rect width="18" height="18" fill="white" />
                                            </clipPath>
                                        </defs>
                                    </svg>
                                    Sign out
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="main-content">
            @RenderBody()
        </div>
    </div>

    <script src="@Url.Content("~/theme/js/jquery-3.6.0.min.js")"></script>
    <script src="@Url.Content("~/theme/js/bootstrap.bundle.min.js")"></script>
    <script src="@Url.Content("~/theme/js/metisMenu.min.js")"></script>
    <script src="@Url.Content("~/theme/js/meanmenu.min.js")"></script>
    <script src="@Url.Content("~/theme/js/swiper-bundle.min.js")"></script>
    <script src="@Url.Content("~/theme/js/slick.min.js")"></script>
    <script src="@Url.Content("~/theme/js/backtotop.js")"></script>
    <script src="@Url.Content("~/theme/js/magnific-popup.min.js")"></script>
    <script src="@Url.Content("~/theme/js/wow.min.js")"></script>
    <script src="@Url.Content("~/theme/js/main.js")"></script>
    @await Html.PartialAsync("_ToastSetUp")
    @await RenderSectionAsync("Scripts", required: false)


    <script>
        $(document).ready(function () {
            $('#menu').metisMenu();

            // Toggle sidebar
            $('#sidebar__active').on('click', function () {
                $('.expovent__sidebar').toggleClass('collapsed');
            });

            // Handle user dropdown
            $('#userportfolio').on('click', function (e) {
                e.preventDefault(); // Ngăn hành vi mặc định của link
                e.stopPropagation(); // Ngăn sự kiện lan truyền lên DOM, tránh đóng ngay lập tức
                $('.user__dropdown').toggle(); // Bật/tắt hiển thị dropdown
            });

            // Close dropdown when clicking outside
            $(document).on('click', function (e) {
                if (!$(e.target).closest('.nav-item.p-relative').length) {
                    $('.user__dropdown').hide();
                }
            });
        });
    </script>
</body>
</html>